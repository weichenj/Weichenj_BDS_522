---
title: "Final Project BDS 503"
output: html_document
---

```{r setup, include=FALSE}
library(ggplot2)
library(dplyr)
load("brfss2013.RData")
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

## reserach question
##1,What is the data source?
##The Behavioral Risk Factor Surveillance System (BRFSS) is the nation’s premier system of health-related telephone surveys that collect state data about U.S. residents regarding their health-related risk behaviors, chronic health conditions, and use of preventive services. 

##2,When were the data collected?
The Newest one is 2016, but I only find the Rdata from 2013。
##3,How were they collected?
There are 486,303 records for 2016, by telephone survey. The November update includes recoding of responses for a variable (LASTDEN3) in California’s data and a calculated variable (_RFPAP33) set to missing in eight states which did not ask a question (HADHYST2) correctly for eight months.
4What are the units of analysis?
Number of people, and score for mental health and physical health and BMI index
2. Describe each variable you are planning to use.
For continuous variables, provide the mean, standard deviation and a histogram.


```{r cars}
project1 <- c(brfss2013$educa,brfss2013$sex,brfss2013$income2,brfss2013$physhlth,brfss2013$menthlth,brfss2013$X_bmi5,brfss2013$genhlth,brfss2013$smoke100)
summary(brfss2013$physhlth)
hist(brfss2013$physhlth)
summary(brfss2013$menthlth)
hist(brfss2013$menthlth)
summary(brfss2013$X_bmi5)
hist(brfss2013$X_bmi5)
```

##State what hypothesis you are interested in the dataset.
##I think I want to see what cause difference among people’s health, and lifetime. The reason why some people live longer and better than others could be due to education, smoking, alcohol consumptions, or gender could be an effect to make difference . 

##research question 1: 
```{r}
Q1 <- brfss2013 %>% filter(!is.na(smoke100)) %>% filter(!is.na(genhlth))
ggplot(Q1, aes(genhlth, fill = smoke100))+geom_bar(position = "stack")
##Clearly in the Excellent and Very Good health, people who don't smoke have greater proporotion. Whihc means smoking reduce the health.
##Let's see the Chi square to test the relationship between the two varibles.
chisq.test(genhlth,smoke100)

```
p-value is small, which indicates that smoking is siginificant related to the general health.

Secondly, 
I want to know the BMI’s relation with  Physical health and Mental Health. 
Buid a regression among BMI  and variable of Income and Sleep time..


```{r}
ggplot(brfss2013, aes(income2, fill = X_bmi5))+geom_bar(position = "stack")
summary(lm(brfss2013$X_bmi5 ~ factor(brfss2013$income2)*brfss2013$sleptim1))
plot(lm(brfss2013$X_bmi5 ~ factor(brfss2013$income2)*brfss2013$sleptim1))
```

#Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
#BMI = 2931.938+58.44*IncomeLess15000+5.57*IncomeLess20000+16.113*IncomeLess25000+33.932*IncomeLess35000+30.643*IncomeLess50000+55.8*IncomeLess75000+10.4*IncomeMore75000 -7.003*Sleeptime-9.208*IncomeLess15000*Sleeptime-5.905*IncomeLess20000*Sleeptime-10.120*IncomeLess25000*Sleeptime-15.046*Less35000*Sleeptime-14.937*IncomeLess5000*Sleeptime -21.020*IncomeLess*Sleeptime -25.273*IncomeMore75000*Sleeptime                           
#from the regreesion above, we can see that among all the factor, only the income more than 75000 per year and less 15000 per year indiviuals has positively significance for BMI and the interpetation would be Keep the sleeping time zero hour, and income less than $15000 per year, increase 58 in BMI, and keep the sleeping time zero hour, and income more than $75000 per year, increases the BMI for 10.404.

#Reserach Question #3
#Lastly, I want to know heart attack acna be predicted using sleep time and smoking and blood pressure. I want to use logistic regression to predict this.

#So we have to see those follow elements: 
#Cvdinfr4 : ever disgonised with heart attack
#Toldhi2 :ever told blood cholesterol high
#Bphgh4: ever told bllod pressure high
#Spletm1:how many hour do you sleep
#Smoke100: ever smoke within the last 100 days

```{r}
Q3 <- names(brfss2013) %in% c("cvdinfr4","smoke100","toldhi2", "bphigh4", "sleptim1")
subdata <- brfss2013[Q3]
subdata$cvdinfr4 <- replace(subdata$cvdinfr4, which(is.na(subdata$cvdinfr4)), "No")

#Make sure that No NA index in our data, so that we have better significance
summary(subdata$cvdinfr4)

#Treat those NA’s into No for smoker, so that I have better conclusion in the end.
subdata$smoke100 <- replace(subdata$smoke100,which(is.na(subdata$smoke100)),"No")
summary(subdata$smoke100)
  
#Treat those NA’s into No for smoker, so that I have better conclusion in the end.
subdata$smoke100 <- replace(subdata$smoke100,which(is.na(subdata$smoke100)),"No")

#Now I want to treat the NA to be the No, so that it is easier for me to conclude later. We
subdata$toldhi2 <- replace(subdata$toldhi2, which(is.na(subdata$toldhi2)), "No")
summary(subdata$toldhi2)

#Look at HIGH blood Pressure Data
table(subdata$bphigh4)
#I have to make sure that female told only during pregnancy to Yes, and told borderline or pre-hypertensive to Yes. In order to make sure logistic regression.
subdata1 <- subdata
subdata1$bphigh4 <- as.factor(ifelse(subdata1$bphigh4=="Yes", "Yes", (ifelse(subdata1$bphigh4=="Yes, but female told only during pregnancy", "Yes",(ifelse(subdata1$bphigh4=="Told borderline or pre-hypertensive", "Yes", "No"))))))
table(subdata1$bphigh4)

#Now we have better data:
table(subdata1$bphigh4)

Q3 <- glm(subdata1$cvdinfr4 ~ subdata1$sleptim1+subdata1$bphigh4+subdata1$smoke100+subdata1$toldhi2, data=subdata1, family = "binomial")
summary(Q3)
plot(Q3)

```

```{r}

```

